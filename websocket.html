<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Matchmaking Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { font-weight: bold; }
    #pingBtn { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>WebSocket Matchmaking Test</h1>
  
  <label for="userID">User ID:</label>
  <input type="text" id="userID" placeholder="Enter your user ID" />
  <button onclick="connect()">Connect</button>

  <p>Status: <span id="status">Not connected</span></p>
  <button id="pingBtn" onclick="sendPing()" disabled>Send Ping to Opponent</button>

  <ul id="log"></ul>

  <script>
    let socket;
    let currentUserID;

    function log(msg) {
      const li = document.createElement('li');
      li.textContent = msg;
      document.getElementById('log').appendChild(li);
    }

    function connect() {
      currentUserID = document.getElementById('userID').value.trim();
      if (!currentUserID) {
        alert("Please enter a user ID");
        return;
      }

      socket = new WebSocket("ws://localhost:8080");

      socket.onopen = () => {
        log("Connected to server");
        socket.send(JSON.stringify({ type: "join", userID: currentUserID }));
        document.getElementById('status').textContent = "Waiting for match...";
      };

      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === 'matched') {
          document.getElementById('status').textContent = "Matched with: " + data.opponent;
          document.getElementById('pingBtn').disabled = false;
          log(`Matched with ${data.opponent}`);
        } else if (data.type === 'ping') {
          log(`Ping received from ${data.from}`);
        } else if (data.type === 'opponent_disconnected') {
          document.getElementById('status').textContent = "Opponent disconnected. Waiting for match...";
          document.getElementById('pingBtn').disabled = true;
          log("Opponent disconnected");
        }
      };

      socket.onclose = () => {
        log("Disconnected from server");
        document.getElementById('status').textContent = "Disconnected";
        document.getElementById('pingBtn').disabled = true;
      };
    }

    function sendPing() {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ type: "ping", userID: currentUserID }));
        log("Ping sent to opponent");
      }
    }
  </script>
</body>
</html>
